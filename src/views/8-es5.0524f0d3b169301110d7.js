(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{ZAaW:function(n,l,e){"use strict";e.r(l);var t=e("CcnG"),u=function(){function n(n){this.messagesService=n}return n.prototype.ngOnInit=function(){},n.prototype.ngOnDestroy=function(){this.messagesService.leaveAllRoom()},n}(),o=function(){return function(){}}(),s=e("pMnS"),r=e("Ip0R"),i=e("gIcY"),c=e("mrSG"),a=e("KJJU"),g=function(){function n(n,l){var e=this;this.chatWith=null,this.objectGroup={},Object.assign(this,n),this.group=this.group.map(function(n){var l=new a.a(n);return e.objectGroup[l._id]=l,l}),l&&this.group.length>1&&(this.chatWith=this.group.find(function(n){return n._id!==l._id}))}return n.prototype.roomName=function(n){return this.name||2!==this.group.length?{nickname:this.name,avatar:""}:this.group.find(function(l){return l._id!==n._id})},Object.defineProperty(n.prototype,"groupList",{get:function(){return this.group.map(function(n){return n.nickname}).join(", ")},enumerable:!0,configurable:!0}),n.prototype.haveNewMess=function(n){return this.read.length&&0===this.read.filter(function(l){return l===n._id}).length},n}(),b=e("oaey"),m=function(n){function l(l,e){var t=n.call(this)||this;return t.messagesService=l,t.storageService=e,t.rooms=[],t.usersSearch=[],t.currentRoom=null,t.form=new i.g({search:new i.e("")}),t.searchIsEmpty=!0,t}return c.c(l,n),l.prototype.ngOnInit=function(){var n=this;this.messagesService.getRooms();var l=this.form.get("search").valueChanges.subscribe(function(l){l&&l.length?(n.searchIsEmpty=!1,n.messagesService.getSearchUsers(l)):(n.usersSearch=[],n.searchIsEmpty=!0)},function(l){return n.errorHandlingService.showError(l)});this.someSubscriptions.add(l);var e=this.messagesService.onRoom().subscribe(function(l){n.currentRoom=new g(l,n.storageService.user),n.rooms.filter(function(l){return l._id===n.currentRoom._id}).length||n.rooms.push(n.currentRoom)},function(l){return n.errorHandlingService.showError(l)});this.someSubscriptions.add(e);var t=this.messagesService.onRooms().subscribe(function(l){n.rooms=l.map(function(l){return new g(l,n.storageService.user)})},function(l){return n.errorHandlingService.showError(l)});this.someSubscriptions.add(t);var u=this.messagesService.onSearchUsers().subscribe(function(l){n.usersSearch=l},function(l){return n.errorHandlingService.showError(l)});this.someSubscriptions.add(u);var o=this.messagesService.onNotiMessage().subscribe(function(l){n.rooms.map(function(n){"string"!=typeof l.owner&&n._id===l.room&&(n.read=[l.owner._id])})},function(l){return n.errorHandlingService.showError(l)});this.someSubscriptions.add(o)},l.prototype.selectUser=function(n){this.messagesService.selectOrCreateRoom(n),this.form.reset()},l.prototype.selectRoom=function(n){n.haveNewMess(this.storageService.user)&&n.read.push(this.storageService.user._id),this.messagesService.selectRoom(n)},l}(b.a),p=e("yFR0"),d=function(){function n(n){this.socketService=n}return n.prototype.onSearchUsers=function(){return this.socketService.listen("onSearchUsers")},n.prototype.onRooms=function(){return this.socketService.listen("onRooms")},n.prototype.onRoom=function(){return this.socketService.listen("onRoom")},n.prototype.onNotiMessage=function(){return this.socketService.listen("onNotiMessage")},n.prototype.getSearchUsers=function(n){this.socketService.emit("searchUsers",n.toLowerCase())},n.prototype.getRooms=function(){this.socketService.emit("rooms")},n.prototype.selectOrCreateRoom=function(n){this.socketService.emit("selectOrCreateRoom",n)},n.prototype.selectRoom=function(n){this.socketService.emit("selectRoom",n)},n.prototype.sendMessage=function(n){this.socketService.emit("message",n)},n.prototype.leaveAllRoom=function(){this.socketService.emit("leaveAllRoom")},n.ngInjectableDef=t.Ib({factory:function(){return new n(t.Mb(p.a))},token:n,providedIn:"root"}),n}(),h=e("fbMX"),f=t.ob({encapsulation:0,styles:[["[_nghost-%COMP%]{display:block;width:25%;border-right:1px solid #000;height:calc(100vh - 76px)}.users-search[_ngcontent-%COMP%]{padding:16px;display:flex;border-bottom:1px solid grey}.users-search[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:4px}.search-list[_ngcontent-%COMP%]{background:silver}.rooms-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .search-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{height:40px;display:flex;padding:8px;cursor:pointer}.rooms-list[_ngcontent-%COMP%]   li.newMess[_ngcontent-%COMP%], .search-list[_ngcontent-%COMP%]   li.newMess[_ngcontent-%COMP%]{border:1px solid red}.rooms-list[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%], .rooms-list[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]:hover, .search-list[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%], .search-list[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]:hover{background:#708090}.rooms-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover, .search-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background:#d3d3d3}.rooms-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .room-avatar[_ngcontent-%COMP%], .search-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .room-avatar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:20%}.rooms-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .room-avatar[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%], .search-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .room-avatar[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{overflow:hidden;width:40px;border-radius:100%;height:40px}"]],data:{}});function v(n){return t.Gb(0,[(n()(),t.qb(0,0,null,null,5,"li",[],[[2,"newMess",null],[2,"selected",null]],[[null,"click"]],function(n,l,e){var t=!0;return"click"===l&&(t=!1!==n.component.selectRoom(n.context.$implicit)&&t),t},null,null)),(n()(),t.qb(1,0,null,null,2,"div",[["class","room-avatar"]],null,null,null,null,null)),(n()(),t.qb(2,0,null,null,1,"span",[["class","avatar"]],null,null,null,null,null)),(n()(),t.qb(3,0,null,null,0,"img",[["alt",""]],[[8,"src",4]],null,null,null,null)),(n()(),t.qb(4,0,null,null,1,"span",[["class","room-name"]],null,null,null,null,null)),(n()(),t.Fb(5,null,["",""]))],null,function(n,l){var e=l.component,t=l.context.$implicit.haveNewMess(e.storageService.user);n(l,0,0,t,l.context.$implicit._id===(null==e.currentRoom?null:e.currentRoom._id)),n(l,3,0,l.context.$implicit.chatWith.avatar),n(l,5,0,l.context.$implicit.chatWith.nickname)})}function C(n){return t.Gb(0,[(n()(),t.qb(0,0,null,null,2,"ul",[["class","rooms-list"]],null,null,null,null,null)),(n()(),t.fb(16777216,null,null,1,null,v)),t.pb(2,278528,null,0,r.i,[t.P,t.M,t.t],{ngForOf:[0,"ngForOf"]},null)],function(n,l){n(l,2,0,l.component.rooms)},null)}function M(n){return t.Gb(0,[(n()(),t.qb(0,0,null,null,6,"li",[],null,[[null,"click"]],function(n,l,e){var t=!0;return"click"===l&&(t=!1!==n.component.selectUser(n.context.$implicit)&&t),t},null,null)),(n()(),t.qb(1,0,null,null,1,"div",[["class","room-avatar"]],null,null,null,null,null)),(n()(),t.qb(2,0,null,null,0,"span",[["class","avatar"]],null,null,null,null,null)),(n()(),t.qb(3,0,null,null,3,"span",[["class","room-name"]],null,null,null,null,null)),(n()(),t.Fb(4,null,[" "," "])),(n()(),t.qb(5,0,null,null,0,"br",[],null,null,null,null,null)),(n()(),t.Fb(6,null,[" "," "]))],null,function(n,l){n(l,4,0,l.context.$implicit.nickname),n(l,6,0,l.context.$implicit.email)})}function _(n){return t.Gb(0,[(n()(),t.qb(0,0,null,null,2,"ul",[["class","search-list"]],null,null,null,null,null)),(n()(),t.fb(16777216,null,null,1,null,M)),t.pb(2,278528,null,0,r.i,[t.P,t.M,t.t],{ngForOf:[0,"ngForOf"]},null)],function(n,l){n(l,2,0,l.component.usersSearch)},null)}function x(n){return t.Gb(0,[(n()(),t.fb(16777216,null,null,1,null,_)),t.pb(1,16384,null,0,r.j,[t.P,t.M],{ngIf:[0,"ngIf"]},null),(n()(),t.fb(0,null,null,0))],function(n,l){n(l,1,0,!l.component.searchIsEmpty)},null)}function O(n){return t.Gb(0,[(n()(),t.qb(0,0,null,null,11,"div",[["class","users-search"]],null,null,null,null,null)),(n()(),t.qb(1,0,null,null,10,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],function(n,l,e){var u=!0;return"submit"===l&&(u=!1!==t.zb(n,3).onSubmit(e)&&u),"reset"===l&&(u=!1!==t.zb(n,3).onReset()&&u),u},null,null)),t.pb(2,16384,null,0,i.v,[],null,null),t.pb(3,540672,null,0,i.h,[[8,null],[8,null]],{form:[0,"form"]},null),t.Cb(2048,null,i.b,null,[i.h]),t.pb(5,16384,null,0,i.m,[[4,i.b]],null,null),(n()(),t.qb(6,0,null,null,5,"input",[["formControlName","search"],["placeholder","search"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(n,l,e){var u=!0;return"input"===l&&(u=!1!==t.zb(n,7)._handleInput(e.target.value)&&u),"blur"===l&&(u=!1!==t.zb(n,7).onTouched()&&u),"compositionstart"===l&&(u=!1!==t.zb(n,7)._compositionStart()&&u),"compositionend"===l&&(u=!1!==t.zb(n,7)._compositionEnd(e.target.value)&&u),u},null,null)),t.pb(7,16384,null,0,i.c,[t.E,t.k,[2,i.a]],null,null),t.Cb(1024,null,i.j,function(n){return[n]},[i.c]),t.pb(9,671744,null,0,i.f,[[3,i.b],[8,null],[8,null],[6,i.j],[2,i.t]],{name:[0,"name"]},null),t.Cb(2048,null,i.k,null,[i.f]),t.pb(11,16384,null,0,i.l,[[4,i.k]],null,null),(n()(),t.qb(12,0,null,null,3,"div",[["class","list"]],null,null,null,null,null)),(n()(),t.fb(16777216,null,null,1,null,C)),t.pb(14,16384,null,0,r.j,[t.P,t.M],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(n()(),t.fb(0,[["searchList",2]],null,0,null,x))],function(n,l){var e=l.component;n(l,3,0,e.form),n(l,9,0,"search"),n(l,14,0,e.searchIsEmpty,t.zb(l,15))},function(n,l){n(l,1,0,t.zb(l,5).ngClassUntouched,t.zb(l,5).ngClassTouched,t.zb(l,5).ngClassPristine,t.zb(l,5).ngClassDirty,t.zb(l,5).ngClassValid,t.zb(l,5).ngClassInvalid,t.zb(l,5).ngClassPending),n(l,6,0,t.zb(l,11).ngClassUntouched,t.zb(l,11).ngClassTouched,t.zb(l,11).ngClassPristine,t.zb(l,11).ngClassDirty,t.zb(l,11).ngClassValid,t.zb(l,11).ngClassInvalid,t.zb(l,11).ngClassPending)})}var P=e("wd/R"),S=function(n){function l(l,e){var t=n.call(this)||this;return t.messagesService=l,t.storageService=e,t.currentRoom=null,t.moment=P,t.form=new i.g({message:new i.e("")}),t}return c.c(l,n),l.prototype.ngOnInit=function(){var n=this,l=this.messagesService.onRoom().subscribe(function(l){n.currentRoom=new g(l)},function(l){return n.errorHandlingService.showError(l)});this.someSubscriptions.add(l)},l.prototype.sendMessage=function(){var n={type:"message",room:this.currentRoom._id,owner:this.storageService.user._id,text:this.form.get("message").value};this.currentRoom.messages.push(n),this.messagesService.sendMessage(n),this.form.reset()},l}(b.a),y=t.ob({encapsulation:0,styles:[["[_nghost-%COMP%]{display:block;width:75%;height:calc(100vh - 76px)}.messages-box[_ngcontent-%COMP%]{display:flex;height:100%;flex-flow:column;justify-content:space-between}.header[_ngcontent-%COMP%], .messages[_ngcontent-%COMP%]{padding:8px}.messages[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{height:calc(100vh - 225px);overflow-y:auto}.messages[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding-top:16px;padding-bottom:16px;display:flex;align-items:center}.messages[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]{width:15%;display:flex;align-items:center;justify-content:center}.messages[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{height:40px;overflow:hidden;width:40px;border-radius:100%}.messages[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{width:85%;padding-right:16px}.messages[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li.owner[_ngcontent-%COMP%]{background:#708090}.form[_ngcontent-%COMP%]{padding:8px;height:60px;display:flex;align-items:center;background:silver}"]],data:{}});function w(n){return t.Gb(0,[(n()(),t.qb(0,0,null,null,10,"li",[],[[2,"owner",null]],null,null,null,null)),(n()(),t.qb(1,0,null,null,2,"div",[["class","message-avatar"]],null,null,null,null,null)),(n()(),t.qb(2,0,null,null,1,"div",[["class","avatar"]],null,null,null,null,null)),(n()(),t.qb(3,0,null,null,0,"img",[["alt",""]],[[8,"src",4]],null,null,null,null)),(n()(),t.qb(4,0,null,null,4,"div",[["class","message-text"]],null,null,null,null,null)),(n()(),t.qb(5,0,null,null,1,"b",[["class","message-name"]],null,null,null,null,null)),(n()(),t.Fb(6,null,["",""])),(n()(),t.qb(7,0,null,null,1,"p",[],null,null,null,null,null)),(n()(),t.Fb(8,null,["",""])),(n()(),t.qb(9,0,null,null,1,"div",[["class","message-time"]],null,null,null,null,null)),(n()(),t.Fb(10,null,[" "," "]))],null,function(n,l){var e=l.component;n(l,0,0,l.context.$implicit.owner===e.storageService.user._id),n(l,3,0,e.currentRoom.objectGroup[l.context.$implicit.owner].avatar),n(l,6,0,e.currentRoom.objectGroup[l.context.$implicit.owner].nickname),n(l,8,0,l.context.$implicit.text),n(l,10,0,e.moment(l.context.$implicit.createdAt).format("DD-MM-YYYY HH:mm"))})}function R(n){return t.Gb(0,[(n()(),t.qb(0,0,null,null,18,"div",[["class","messages-box"]],null,null,null,null,null)),(n()(),t.qb(1,0,null,null,3,"div",[["class","messages"]],null,null,null,null,null)),(n()(),t.qb(2,0,null,null,2,"ul",[],null,null,null,null,null)),(n()(),t.fb(16777216,null,null,1,null,w)),t.pb(4,278528,null,0,r.i,[t.P,t.M,t.t],{ngForOf:[0,"ngForOf"]},null),(n()(),t.qb(5,0,null,null,13,"div",[["class","form"]],null,null,null,null,null)),(n()(),t.qb(6,0,null,null,12,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngSubmit"],[null,"submit"],[null,"reset"]],function(n,l,e){var u=!0,o=n.component;return"submit"===l&&(u=!1!==t.zb(n,8).onSubmit(e)&&u),"reset"===l&&(u=!1!==t.zb(n,8).onReset()&&u),"ngSubmit"===l&&(u=!1!==o.sendMessage()&&u),u},null,null)),t.pb(7,16384,null,0,i.v,[],null,null),t.pb(8,540672,null,0,i.h,[[8,null],[8,null]],{form:[0,"form"]},{ngSubmit:"ngSubmit"}),t.Cb(2048,null,i.b,null,[i.h]),t.pb(10,16384,null,0,i.m,[[4,i.b]],null,null),(n()(),t.qb(11,0,null,null,5,"input",[["formControlName","message"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(n,l,e){var u=!0;return"input"===l&&(u=!1!==t.zb(n,12)._handleInput(e.target.value)&&u),"blur"===l&&(u=!1!==t.zb(n,12).onTouched()&&u),"compositionstart"===l&&(u=!1!==t.zb(n,12)._compositionStart()&&u),"compositionend"===l&&(u=!1!==t.zb(n,12)._compositionEnd(e.target.value)&&u),u},null,null)),t.pb(12,16384,null,0,i.c,[t.E,t.k,[2,i.a]],null,null),t.Cb(1024,null,i.j,function(n){return[n]},[i.c]),t.pb(14,671744,null,0,i.f,[[3,i.b],[8,null],[8,null],[6,i.j],[2,i.t]],{name:[0,"name"]},null),t.Cb(2048,null,i.k,null,[i.f]),t.pb(16,16384,null,0,i.l,[[4,i.k]],null,null),(n()(),t.qb(17,0,null,null,1,"button",[["type","submit"]],null,null,null,null,null)),(n()(),t.Fb(-1,null,["Send"]))],function(n,l){var e=l.component;n(l,4,0,e.currentRoom.messages),n(l,8,0,e.form),n(l,14,0,"message")},function(n,l){n(l,6,0,t.zb(l,10).ngClassUntouched,t.zb(l,10).ngClassTouched,t.zb(l,10).ngClassPristine,t.zb(l,10).ngClassDirty,t.zb(l,10).ngClassValid,t.zb(l,10).ngClassInvalid,t.zb(l,10).ngClassPending),n(l,11,0,t.zb(l,16).ngClassUntouched,t.zb(l,16).ngClassTouched,t.zb(l,16).ngClassPristine,t.zb(l,16).ngClassDirty,t.zb(l,16).ngClassValid,t.zb(l,16).ngClassInvalid,t.zb(l,16).ngClassPending)})}function k(n){return t.Gb(0,[(n()(),t.fb(16777216,null,null,1,null,R)),t.pb(1,16384,null,0,r.j,[t.P,t.M],{ngIf:[0,"ngIf"]},null)],function(n,l){n(l,1,0,l.component.currentRoom)},null)}var z=t.ob({encapsulation:0,styles:[[".messages[_ngcontent-%COMP%]{display:flex;border-right:1px solid #000;border-left:1px solid #000;border-bottom:1px solid #000;background:#fff}"]],data:{}});function q(n){return t.Gb(0,[(n()(),t.qb(0,0,null,null,4,"div",[["class","messages"]],null,null,null,null,null)),(n()(),t.qb(1,0,null,null,1,"app-sidebar",[],null,null,null,O,f)),t.pb(2,245760,null,0,m,[d,h.a],null,null),(n()(),t.qb(3,0,null,null,1,"app-messages-box",[],null,null,null,k,y)),t.pb(4,245760,null,0,S,[d,h.a],null,null)],function(n,l){n(l,2,0),n(l,4,0)},null)}function I(n){return t.Gb(0,[(n()(),t.qb(0,0,null,null,1,"app-messages",[],null,null,null,q,z)),t.pb(1,245760,null,0,u,[d],null,null)],function(n,l){n(l,1,0)},null)}var j=t.mb("app-messages",u,I,{},{},[]),E=e("t/Na"),G=e("ZYCi"),F=e("XPwU"),N=e("eG2b"),U=e("yTb8"),$=e("NHGN"),H=e("SZbH"),T=e("Zseb"),D=e("PCNd"),Y=function(){return function(){}}();e.d(l,"MessagesRoutingModuleNgFactory",function(){return A});var A=t.nb(o,[],function(n){return t.wb([t.xb(512,t.j,t.ab,[[8,[s.a,j]],[3,t.j],t.y]),t.xb(4608,r.l,r.k,[t.v,[2,r.t]]),t.xb(4608,i.s,i.s,[]),t.xb(4608,E.h,E.n,[r.c,t.C,E.l]),t.xb(4608,E.o,E.o,[E.h,E.m]),t.xb(4608,h.a,h.a,[G.o]),t.xb(4608,E.k,E.k,[]),t.xb(6144,E.i,null,[E.k]),t.xb(4608,E.g,E.g,[E.i]),t.xb(6144,E.b,null,[E.g]),t.xb(4608,E.f,E.j,[E.b,t.r]),t.xb(4608,E.c,E.c,[E.f]),t.xb(5120,E.a,function(n,l,e,t,u){return[n,new F.a(l,e,t,u)]},[E.o,h.a,G.o,G.a,E.c]),t.xb(4608,i.d,i.d,[]),t.xb(4608,N.g,N.d,[E.c]),t.xb(5120,N.f,N.c,[[3,N.f],N.g,t.C,[2,N.b],[2,r.c]]),t.xb(4608,U.a,U.a,[E.c]),t.xb(4608,$.a,$.a,[H.j,h.a]),t.xb(1073742336,G.q,G.q,[[2,G.v],[2,G.o]]),t.xb(1073742336,r.b,r.b,[]),t.xb(1073742336,i.r,i.r,[]),t.xb(1073742336,i.i,i.i,[]),t.xb(1073742336,E.e,E.e,[]),t.xb(1073742336,E.d,E.d,[]),t.xb(1073742336,i.p,i.p,[]),t.xb(1073742336,T.b,T.b,[]),t.xb(1073742336,N.a,N.a,[]),t.xb(1073742336,D.a,D.a,[]),t.xb(1073742336,Y,Y,[]),t.xb(1073742336,o,o,[]),t.xb(256,E.l,"XSRF-TOKEN",[]),t.xb(256,E.m,"X-XSRF-TOKEN",[]),t.xb(1024,G.m,function(){return[[{path:"",component:u}]]},[])])})}}]);